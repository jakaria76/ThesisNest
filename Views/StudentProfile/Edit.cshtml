@model ThesisNest.Models.StudentProfile
@{
    ViewData["Title"] = "Edit Student Profile";

    var imgSrc = (Model?.ProfileImage != null && !string.IsNullOrEmpty(Model.ProfileImageContentType))
        ? Url.Action("Photo", "StudentProfile", new { id = Model.Id })
        : "https://via.placeholder.com/140x140.png?text=User";
}

<div class="container-xxl py-4">
    <h3 class="mb-3">@ViewData["Title"]</h3>

    <form asp-action="Edit" method="post" enctype="multipart/form-data" class="card border-0 shadow-sm">
        @Html.AntiForgeryToken()
        @Html.HiddenFor(m => m.Id)

        <div class="card-body">
            <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

            <!-- Photo + quick actions -->
            <div class="d-flex align-items-center gap-3 mb-4">
                <img id="previewImg" src="@imgSrc" class="rounded-circle shadow-sm"
                     style="width:96px;height:96px;object-fit:cover" alt="photo" />
                <div class="flex-grow-1">
                    <label class="form-label">Change Photo</label>
                    <input type="file" name="ProfileImageFile" id="inpPhoto" class="form-control" accept="image/*" />
                    <div class="form-text">JPEG/PNG/WebP, max 2MB</div>
                    <div class="form-check mt-2">
                        <input class="form-check-input" type="checkbox" name="removePhoto" id="removePhoto" />
                        <label class="form-check-label" for="removePhoto">Remove current photo</label>
                    </div>
                    <span class="text-danger" data-valmsg-for="ProfileImage"></span>
                </div>
            </div>

            <div class="row g-3">
                <!-- Basic info -->
                <div class="col-md-6">
                    <label asp-for="FullName" class="form-label"></label>
                    <input asp-for="FullName" class="form-control" />
                    <span asp-validation-for="FullName" class="text-danger"></span>
                </div>

                <div class="col-md-6">
                    <label asp-for="ProfilePictureUrl" class="form-label"></label>
                    <input asp-for="ProfilePictureUrl" class="form-control" />
                    <div class="form-text">Optional: external image URL (kept for legacy).</div>
                </div>

                <div class="col-md-4">
                    <label asp-for="DateOfBirth" class="form-label"></label>
                    <input asp-for="DateOfBirth" class="form-control" type="date" />
                </div>

                <div class="col-md-4">
                    <label asp-for="Gender" class="form-label"></label>
                    <input asp-for="Gender" class="form-control" />
                </div>

                <div class="col-md-4">
                    <label asp-for="PhoneNumber" class="form-label"></label>
                    <input asp-for="PhoneNumber" class="form-control" />
                </div>

                <div class="col-md-6">
                    <label asp-for="Email" class="form-label"></label>
                    <input asp-for="Email" class="form-control" />
                </div>

                <div class="col-md-6">
                    <label asp-for="Address" class="form-label"></label>
                    <input asp-for="Address" class="form-control" />
                </div>

                <!-- Academic -->
                <div class="col-md-6">
                    <label asp-for="University" class="form-label"></label>
                    <input asp-for="University" class="form-control" />
                </div>

                <div class="col-md-6">
                    <label asp-for="Department" class="form-label"></label>
                    <input asp-for="Department" class="form-control" />
                </div>

                <div class="col-md-4">
                    <label asp-for="StudentId" class="form-label"></label>
                    <input asp-for="StudentId" class="form-control" />
                </div>

                <div class="col-md-4">
                    <label asp-for="Semester" class="form-label"></label>
                    <input asp-for="Semester" class="form-control" />
                </div>

                <div class="col-md-4">
                    <label asp-for="GPA" class="form-label">CGPA</label>
                    <input asp-for="GPA" class="form-control" type="number" step="0.01" />
                </div>

                <!-- Thesis -->
                <div class="col-md-6">
                    <label asp-for="ThesisTitle" class="form-label"></label>
                    <input asp-for="ThesisTitle" class="form-control" />
                </div>

                <div class="col-md-6">
                    <label asp-for="Supervisor" class="form-label"></label>
                    <input asp-for="Supervisor" class="form-control" />
                </div>

                <div class="col-md-6">
                    <label asp-for="ThesisStatus" class="form-label"></label>
                    <select asp-for="ThesisStatus" class="form-select">
                        <option value="">-- Select --</option>
                        <option value="Proposal">Proposal</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Completed">Completed</option>
                    </select>
                </div>

                <div class="col-md-6">
                    <label asp-for="SubmissionDate" class="form-label"></label>
                    <input asp-for="SubmissionDate" class="form-control" type="date" />
                </div>

                <div class="col-12">
                    <label asp-for="Feedback" class="form-label"></label>
                    <textarea asp-for="Feedback" class="form-control" rows="3"></textarea>
                </div>

                <!-- Skills & Achievements -->
                <div class="col-12">
                    <label asp-for="Skills" class="form-label"></label>
                    <textarea asp-for="Skills" class="form-control" rows="2"
                              placeholder="e.g., C#, ASP.NET Core, SQL, Git"></textarea>
                </div>

                <div class="col-12">
                    <label asp-for="Achievements" class="form-label"></label>
                    <textarea asp-for="Achievements" class="form-control" rows="2"
                              placeholder="e.g., Dean’s List, Hackathon Winner"></textarea>
                </div>

                <!-- Social Links -->
                <div class="col-md-4">
                    <label asp-for="LinkedIn" class="form-label"></label>
                    <input asp-for="LinkedIn" class="form-control" placeholder="https://linkedin.com/in/…" />
                </div>

                <div class="col-md-4">
                    <label asp-for="GitHub" class="form-label"></label>
                    <input asp-for="GitHub" class="form-control" placeholder="https://github.com/username" />
                </div>

                <div class="col-md-4">
                    <label asp-for="Portfolio" class="form-label"></label>
                    <input asp-for="Portfolio" class="form-control" placeholder="https://your-site.com" />
                </div>
            </div>
        </div>

        <div class="card-footer d-flex justify-content-end gap-2">
            <a asp-action="Index" class="btn btn-light">Cancel</a>
            <button class="btn btn-primary" type="submit">Update</button>
        </div>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Live photo preview + size check
        (function () {
            const inp = document.getElementById('inpPhoto');
            const img = document.getElementById('previewImg');
            if (!inp || !img) return;

            inp.addEventListener('change', function (e) {
                const f = e.target.files?.[0];
                if (!f) return;
                if (f.size > 2 * 1024 * 1024) {
                    alert("Max 2MB image allowed.");
                    e.target.value = "";
                    return;
                }
                const url = URL.createObjectURL(f);
                img.src = url;
            });
        })();
    </script>
}

@section Styles {
    <style>
        .form-text {
            color: var(--muted);
        }
    </style>
}
