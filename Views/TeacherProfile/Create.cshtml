@model ThesisNest.Models.TeacherProfile
@{
    ViewData["Title"] = "Create Teacher Profile";
    var imgSrc = "https://via.placeholder.com/160x160.png?text=User";
}

<div class="container-xxl py-4">
    <h3>@ViewData["Title"]</h3>

    <form asp-action="Create" method="post" enctype="multipart/form-data">
        @Html.AntiForgeryToken()
        @Html.ValidationSummary(false, "", new { @class = "text-danger" })

        <!-- Basic Info -->
        <div class="row g-3 mb-3">
            <div class="col-md-6">
                <label asp-for="FullName" class="form-label"></label>
                <input asp-for="FullName" class="form-control" />
                <span asp-validation-for="FullName" class="text-danger"></span>
            </div>
            <div class="col-md-6">
                <label asp-for="Designation" class="form-label"></label>
                <input asp-for="Designation" class="form-control" />
                <span asp-validation-for="Designation" class="text-danger"></span>
            </div>
            <div class="col-md-6">
                <label asp-for="Department" class="form-label"></label>
                <input asp-for="Department" class="form-control" />
                <span asp-validation-for="Department" class="text-danger"></span>
            </div>
            <div class="col-md-6">
                <label asp-for="OfficeLocation" class="form-label"></label>
                <input asp-for="OfficeLocation" class="form-control" />
                <span asp-validation-for="OfficeLocation" class="text-danger"></span>
            </div>
            <div class="col-md-4">
                <label asp-for="Email" class="form-label"></label>
                <input asp-for="Email" class="form-control" />
                <span asp-validation-for="Email" class="text-danger"></span>
            </div>
            <div class="col-md-4">
                <label asp-for="Phone" class="form-label"></label>
                <input asp-for="Phone" class="form-control" />
                <span asp-validation-for="Phone" class="text-danger"></span>
            </div>
            <div class="col-md-2 form-check mt-4">
                <input asp-for="IsPublicEmail" class="form-check-input" type="checkbox" id="IsPublicEmail" />
                <label class="form-check-label" for="IsPublicEmail">Email Public</label>
            </div>
            <div class="col-md-2 form-check mt-4">
                <input asp-for="IsPublicPhone" class="form-check-input" type="checkbox" id="IsPublicPhone" />
                <label class="form-check-label" for="IsPublicPhone">Phone Public</label>
            </div>
            <div class="col-md-6">
                <label asp-for="Bio" class="form-label"></label>
                <textarea asp-for="Bio" class="form-control" rows="3"></textarea>
                <span asp-validation-for="Bio" class="text-danger"></span>
            </div>
            <div class="col-md-6">
                <label asp-for="ResearchSummary" class="form-label"></label>
                <textarea asp-for="ResearchSummary" class="form-control" rows="3"></textarea>
                <span asp-validation-for="ResearchSummary" class="text-danger"></span>
            </div>

            <div class="col-md-3">
                <label asp-for="Latitude" class="form-label"></label>
                <input asp-for="Latitude" class="form-control" type="number" step="0.0000001" />
                <span asp-validation-for="Latitude" class="text-danger"></span>
            </div>
            <div class="col-md-3">
                <label asp-for="Longitude" class="form-label"></label>
                <input asp-for="Longitude" class="form-control" type="number" step="0.0000001" />
                <span asp-validation-for="Longitude" class="text-danger"></span>
            </div>

            <div class="col-md-6">
                <label class="form-label">Profile Image</label>
                <input type="file" name="ProfileImageFile" class="form-control" accept="image/*" />
                <div class="mt-2">
                    <img src="@imgSrc" alt="Current photo" class="img-thumbnail" style="max-width: 160px;" />
                </div>
            </div>
        </div>

        <!-- Dynamic Sections -->
        <h5>Educational Background</h5>
        <div id="educationContainer"></div>
        <button type="button" class="btn btn-outline-primary mb-3" id="addEducation">+ Add Education</button>

        <h5>Achievements</h5>
        <div id="achievementContainer"></div>
        <button type="button" class="btn btn-outline-primary mb-3" id="addAchievement">+ Add Achievement</button>

        <h5>Publications</h5>
        <div id="publicationContainer"></div>
        <button type="button" class="btn btn-outline-primary mb-3" id="addPublication">+ Add Publication</button>

        <button type="submit" class="btn btn-success">Create Profile</button>
    </form>
</div>

@section Scripts {
    <script>
        let eduIndex = 0, achIndex = 0, pubIndex = 0;

        function eduBlock(i) {
            return `
            <div class="education-item mb-2 border p-2">
                <input type="hidden" name="Educations[${i}].Id" value="0" />
                <input name="Educations[${i}].Degree" class="form-control mb-1" placeholder="Degree" />
                <input name="Educations[${i}].Institution" class="form-control mb-1" placeholder="Institution" />
                <input name="Educations[${i}].BoardOrUniversity" class="form-control mb-1" placeholder="Board/University" />
                <input name="Educations[${i}].FieldOfStudy" class="form-control mb-1" placeholder="Field of Study" />
                <input name="Educations[${i}].PassingYear" type="number" class="form-control mb-1" placeholder="Year" />
                <input name="Educations[${i}].Result" class="form-control mb-1" placeholder="Result" />
                <input name="Educations[${i}].Country" class="form-control mb-1" placeholder="Country" />
                <button type="button" class="btn btn-danger btn-sm remove-edu">Remove</button>
            </div>`;
        }

        function achBlock(i) {
            return `
            <div class="achievement-item mb-2 border p-2">
                <input type="hidden" name="Achievements[${i}].Id" value="0" />
                <input name="Achievements[${i}].Title" class="form-control mb-1" placeholder="Title" />
                <input name="Achievements[${i}].Issuer" class="form-control mb-1" placeholder="Issuer" />
                <input type="date" name="Achievements[${i}].IssuedOn" class="form-control mb-1" />
                <input name="Achievements[${i}].Url" class="form-control mb-1" placeholder="URL (optional)" />
                <textarea name="Achievements[${i}].Description" class="form-control mb-1" rows="2" placeholder="Description"></textarea>
                <button type="button" class="btn btn-danger btn-sm remove-ach">Remove</button>
            </div>`;
        }

        function pubBlock(i) {
            return `
            <div class="publication-item mb-2 border p-2">
                <input type="hidden" name="Publications[${i}].Id" value="0" />
                <input name="Publications[${i}].Title" class="form-control mb-1" placeholder="Title" />
                <input name="Publications[${i}].VenueType" class="form-control mb-1" placeholder="Venue Type (Journal/Conference/Book)" />
                <input name="Publications[${i}].VenueName" class="form-control mb-1" placeholder="Venue Name" />
                <input name="Publications[${i}].Year" type="number" class="form-control mb-1" placeholder="Year" />
                <input name="Publications[${i}].Volume" class="form-control mb-1" placeholder="Volume" />
                <input name="Publications[${i}].Issue" class="form-control mb-1" placeholder="Issue" />
                <input name="Publications[${i}].Pages" class="form-control mb-1" placeholder="Pages" />
                <input name="Publications[${i}].DOI" class="form-control mb-1" placeholder="DOI" />
                <input name="Publications[${i}].Url" class="form-control mb-1" placeholder="URL" />
                <input name="Publications[${i}].CoAuthors" class="form-control mb-1" placeholder="Co-authors" />
                <textarea name="Publications[${i}].Abstract" class="form-control mb-1" rows="2" placeholder="Abstract"></textarea>
                <button type="button" class="btn btn-danger btn-sm remove-pub">Remove</button>
            </div>`;
        }

        document.getElementById("addEducation").addEventListener("click", () => {
            document.getElementById("educationContainer").insertAdjacentHTML("beforeend", eduBlock(eduIndex++));
        });
        document.getElementById("addAchievement").addEventListener("click", () => {
            document.getElementById("achievementContainer").insertAdjacentHTML("beforeend", achBlock(achIndex++));
        });
        document.getElementById("addPublication").addEventListener("click", () => {
            document.getElementById("publicationContainer").insertAdjacentHTML("beforeend", pubBlock(pubIndex++));
        });

        document.addEventListener("click", function (e) {
            if (e.target.classList.contains("remove-edu")) e.target.closest(".education-item")?.remove();
            if (e.target.classList.contains("remove-ach")) e.target.closest(".achievement-item")?.remove();
            if (e.target.classList.contains("remove-pub")) e.target.closest(".publication-item")?.remove();
        });
    </script>
}
