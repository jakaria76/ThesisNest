@using Microsoft.AspNetCore.Identity
@using ThesisNest.Models
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager

@{
    ApplicationUser? currentUser = null;
    string displayName = "Account";
    if (SignInManager.IsSignedIn(User))
    {
        currentUser = await UserManager.GetUserAsync(User);
        displayName = !string.IsNullOrWhiteSpace(currentUser?.FullName)
            ? currentUser!.FullName!
            : (currentUser?.UserName ?? "Account");
    }
}

@if (SignInManager.IsSignedIn(User))
{
    <!-- Logged-in dropdown -->
    <ul class="navbar-nav ms-auto align-items-center">
        <li class="nav-item dropdown">
            <button class="btn btn-sm btn-outline-light dropdown-toggle d-flex align-items-center"
                    id="userMenu" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="bi bi-person-circle me-2"></i>
                <span class="text-truncate" style="max-width: 160px;">@displayName</span>
            </button>
            <ul class="dropdown-menu dropdown-menu-end dropdown-menu-dark" aria-labelledby="userMenu">               
                <li><hr class="dropdown-divider" /></li>
                <li>
                    <form asp-controller="Account"
                          asp-action="Logout"
                          method="post" class="px-2 m-0">
                        @Html.AntiForgeryToken()
                        <button type="submit" class="dropdown-item">
                            <i class="bi bi-box-arrow-right me-2"></i> Logout
                        </button>
                    </form>
                </li>
            </ul>
        </li>
    </ul>
}
else
{
    <!-- Logged-out: Register + Login side by side -->
    <ul class="navbar-nav ms-auto align-items-center">
        <li class="nav-item">
            <div class="d-flex gap-2">
                <a class="btn btn-sm btn-primary"
                   asp-controller="Account" asp-action="Register"
                   asp-route-returnUrl="@(Context.Request.Path + Context.Request.QueryString)">
                    Register
                </a>


                <a class="btn btn-sm btn-primary"
                   asp-controller="Account" asp-action="Login"
                   asp-route-returnUrl="@(Context.Request.Path + Context.Request.QueryString)">
                    Login
                </a>
            </div>
        </li>
    </ul>
}
